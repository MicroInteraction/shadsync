<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>ShadSync</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      font-size: 14px;
      background: white;
      color: #333333;
      padding: 0;
      margin: 0;
      height: 100vh;
      overflow: hidden;
    }

    .container {
      padding: 0;
      height: 100vh;
      overflow: hidden;
    }

    .card {
      background: white;
      border-radius: 0;
      padding: 12px;
      height: 100vh;
      overflow-y: auto;
      margin: 0;
    }

    .header {
      margin-bottom: 24px;
    }

    .logo {
      margin-bottom: 24px;
      display: flex;
      align-items: center;
    }

    .logo svg {
      width: 116px;
      height: 21px;
    }

    .tabs {
      display: flex;
      gap: 0;
      margin-bottom: 32px;
      background: #F5F5F5;
      border-radius: 12px;
      padding: 4px;
    }

    .tab {
      flex: 1;
      padding: 12px 16px;
      border: none;
      background: transparent;
      border-radius: 10px;
      cursor: pointer;
      color: var(--foreground, #000);
      font-size: 15px;
      font-style: normal;
      font-weight: 500;
      line-height: 20px; /* 133.333% */
      letter-spacing: -0.45px;
      text-align: center;
      opacity: 0.3;
      transition: all 0.2s ease;
      height: 36px;
    }

    .tab.active {
      border: 1px solid #F2F2F2;
      background: #FFF;
      box-shadow: 0px 4px 4px -5px rgba(0, 0, 0, 0.10);
      color: var(--foreground, #000);
      opacity: 1;
    }

    .tab:hover:not(.active) {
      background: #E5E7EB;
      color: #374151;
    }

    .section {
      margin-bottom: 24px;
    }

    .section-title {
      color: #1F2937;
      font-size: 16px;
      font-style: normal;
      font-weight: 500;
      line-height: 28px; /* 175% */
      letter-spacing: -0.45px;
      margin-bottom: 12px;
    }

    .input-group {
      margin-bottom: 16px;
    }

    label {
      display: block;
      font-size: 12px;
      font-weight: 500;
      color: #666666;
      margin-bottom: 6px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    textarea {
      width: 100%;
      min-height: 200px;
      padding: 12px;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      font-family: 'SF Mono', Monaco, 'Cascadia Code', monospace;
      font-size: 12px;
      line-height: 1.5;
      resize: vertical;
      background: #fafafa;
    }

    textarea::placeholder {
      color: #999999;
    }

    textarea:focus {
      outline: none;
      border-color: #ff6b35;
      box-shadow: 0 0 0 2px rgba(255, 107, 53, 0.1);
    }

    select {
      width: 100%;
      padding: 8px 12px;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      background: white;
      font-size: 14px;
    }

    select:focus {
      outline: none;
      border-color: #ff6b35;
    }

    .button {
      width: 100%;
      padding: 12px 16px;
      border: none;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      margin-bottom: 8px;
    }

    .button-primary {
      background: #FF6C46;
      color: white;
    }

    .button-primary:hover {
      background: #E55A3A;
    }

    .button-secondary {
      background: #F8F9FA;
      color: #374151;
      border: 1px solid #E5E7EB;
    }

    .button-secondary:hover {
      background: #F3F4F6;
      border-color: #D1D5DB;
    }

    .replace-btn {
      background: #FF6C46;
      color: white;
      border: none;
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
    }

    .replace-btn:hover {
      background: #E55A3A;
    }

    .replace-btn:disabled {
      background: #D1D5DB;
      cursor: not-allowed;
    }

    .button-secondary:hover {
      background: #F3F4F6;
      border-color: #D1D5DB;
    }

    .status {
      padding: 12px;
      border-radius: 6px;
      margin-bottom: 16px;
      font-size: 12px;
      line-height: 1.4;
      display: none;
    }

    .status.success {
      background: #e8f5e8;
      color: #2d5a2d;
      border: 1px solid #c3e6c3;
    }

    .status.error {
      background: #ffeaea;
      color: #d32f2f;
      border: 1px solid #ffcdd2;
    }

    .status.info {
      background: #e3f2fd;
      color: #1976d2;
      border: 1px solid #bbdefb;
    }

    .variables-list {
      max-height: 200px;
      overflow-y: auto;
      border: 1px solid #e0e0e0;
      border-radius: 6px;
      background: #fafafa;
    }

    .variable-item {
      padding: 8px 12px;
      border-bottom: 1px solid #e0e0e0;
      font-size: 12px;
      font-family: 'SF Mono', Monaco, monospace;
    }

    .variable-item:last-child {
      border-bottom: none;
    }

    .collection-group {
      margin-bottom: 16px;
    }

    .collection-title {
      font-weight: 600;
      color: #333333;
      margin-bottom: 8px;
      font-size: 13px;
    }

    .hidden {
      display: none !important;
    }

    .tab-content {
      display: block;
    }

    .tab-content.hidden {
      display: none !important;
    }

    .loading {
      opacity: 0.6;
      pointer-events: none;
    }

    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
      margin-bottom: 16px;
    }

    .checkbox-group input[type="checkbox"] {
      margin: 0;
    }

    .checkbox-group label {
      margin: 0;
      font-size: 14px;
      text-transform: none;
      letter-spacing: normal;
      color: #333333;
    }

    .suggestion-item {
      background: #f8f9fa;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
    }

    .suggestion-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .object-info {
      font-size: 12px;
      color: #666;
      font-family: 'SF Mono', Monaco, monospace;
    }

    .current-variable {
      font-size: 12px;
      color: #666;
      margin-bottom: 8px;
    }

    .suggestion-row {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 8px;
      background: white;
      border-radius: 4px;
      border: 1px solid #e0e0e0;
    }

    .color-preview {
      width: 16px;
      height: 16px;
      border-radius: 3px;
      border: 1px solid #ccc;
      flex-shrink: 0;
    }

    .variable-name {
      flex: 1;
      font-size: 12px;
      font-family: 'SF Mono', Monaco, monospace;
      color: #333;
    }

    .replace-btn {
      padding: 4px 8px;
      font-size: 11px;
      background: #ff6b35;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .replace-btn:hover {
      background: #ff5722;
    }

    .replace-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .no-suggestion {
      color: #999;
      font-style: italic;
      font-size: 12px;
    }

    .suggestion-list {
      max-height: 400px;
      overflow-y: auto;
    }

    .dropdown-suggestions {
      margin-top: 8px;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      background: white;
      max-height: 150px;
      overflow-y: auto;
      display: none;
    }

    .dropdown-suggestions.show {
      display: block;
    }

    .dropdown-item {
      padding: 6px 8px;
      cursor: pointer;
      font-size: 11px;
      display: flex;
      align-items: center;
      gap: 6px;
      border-bottom: 1px solid #f0f0f0;
    }

    .dropdown-item:last-child {
      border-bottom: none;
    }

    .dropdown-item:hover {
      background: #f5f5f5;
    }

    .suggestion-score {
      font-size: 10px;
      color: #999;
      margin-left: auto;
    }

    .current-selection {
      background: #e3f2fd !important;
      color: #1976d2;
    }

    .select-dropdown {
      width: 100%;
      padding: 4px 8px;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      background: white;
      font-size: 12px;
      font-family: 'SF Mono', Monaco, monospace;
    }

    .variable-group {
      background: #ffffff;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      margin-bottom: 16px;
      overflow: hidden;
    }

    .variable-group-header {
      background: #fff3f0;
      padding: 12px;
      border-bottom: 1px solid #e0e0e0;
    }

    .affected-objects {
      background: #fafafa;
      padding: 12px;
    }

    .object-item {
      display: flex;
      align-items: center;
      padding: 6px 0;
      border-bottom: 1px solid #eee;
    }

    .object-item:last-child {
      border-bottom: none;
    }

    .group-replacement {
      margin-top: 12px;
    }

    .suggestion-item {
      background: #f8f9fa;
      border: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 12px;
      margin-bottom: 12px;
    }

    .suggestion-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 8px;
    }

    .object-info {
      font-size: 12px;
      color: #666;
      font-family: 'SF Mono', Monaco, monospace;
    }

    .current-variable {
      font-size: 12px;
      color: #666;
      margin-bottom: 8px;
    }

    .suggestion-row {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 6px 8px;
      background: white;
      border-radius: 4px;
      border: 1px solid #e0e0e0;
    }

    .color-preview {
      width: 16px;
      height: 16px;
      border-radius: 3px;
      border: 1px solid #ccc;
      flex-shrink: 0;
    }

    .variable-name {
      flex: 1;
      font-size: 12px;
      font-family: 'SF Mono', Monaco, monospace;
      color: #333;
    }

    .replace-btn {
      padding: 4px 8px;
      font-size: 11px;
      background: #ff6b35;
      color: white;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      transition: background 0.2s;
    }

    .replace-btn:hover {
      background: #ff5722;
    }

    .replace-btn:disabled {
      background: #ccc;
      cursor: not-allowed;
    }

    .no-suggestion {
      color: #999;
      font-style: italic;
      font-size: 12px;
    }

    .suggestion-list {
      max-height: 400px;
      overflow-y: auto;
    }

    .dropdown-suggestions {
      margin-top: 8px;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      background: white;
      max-height: 150px;
      overflow-y: auto;
      display: none;
    }

    .dropdown-suggestions.show {
      display: block;
    }

    .dropdown-item {
      padding: 6px 8px;
      cursor: pointer;
      font-size: 11px;
      display: flex;
      align-items: center;
      gap: 6px;
      border-bottom: 1px solid #f0f0f0;
    }

    .dropdown-item:last-child {
      border-bottom: none;
    }

    .dropdown-item:hover {
      background: #f5f5f5;
    }

    .suggestion-score {
      font-size: 10px;
      color: #999;
      margin-left: auto;
    }

    .current-selection {
      background: #e3f2fd !important;
      color: #1976d2;
    }

    .select-dropdown {
      width: 100%;
      padding: 4px 8px;
      border: 1px solid #e0e0e0;
      border-radius: 4px;
      background: white;
      font-size: 12px;
      font-family: 'SF Mono', Monaco, monospace;
    }
    
    /* Modern Detect Interface Styles */
    .scan-section {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 24px;
    }

    .scan-title {
      font-size: 18px;
      font-weight: 600;
      color: #1F2937;
    }

    .scan-actions {
      display: flex;
      gap: 4px;
      align-items: center;
    }

    /* Scan Button */
    .scan-btn {
      display: flex;
      padding: 4px 16px;
      align-items: center;
      gap: 8px;
      border-radius: 10px;
      background: var(--muted, #F5F5F5);
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
      color: var(--foreground, #000);
      font-size: 15px;
      font-style: normal;
      font-weight: 500;
      line-height: 20px;
      letter-spacing: -0.45px;
    }

    .scan-btn:hover {
      opacity: 0.9;
    }

    /* Replace All Button */
    .replace-all-btn {
      display: flex;
      padding: 4px 16px;
      align-items: center;
      gap: 8px;
      border-radius: 10px;
      background: var(--primary, #FF6C46);
      border: none;
      cursor: pointer;
      transition: all 0.2s ease;
      color: white;
      font-size: 15px;
      font-style: normal;
      font-weight: 500;
      line-height: 20px;
      letter-spacing: -0.45px;
    }

    .replace-all-btn:hover {
      opacity: 0.9;
    }

    .replace-all-btn:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }

    .replace-all-btn:disabled:hover {
      opacity: 0.5;
    }

    /* Variable Group Styles */
    .variable-section {
      background: #F8F9FA;
      border-radius: 12px;
      padding: 16px;
      margin-bottom: 16px;
    }

    .variable-section-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .variable-section-title {
      font-size: 16px;
      font-weight: 600;
      color: #1F2937;
    }

    .variable-count {
      background: #E5E7EB;
      color: #374151;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 13px;
      font-weight: 600;
    }

    .variable-item {
      background: white;
      border-radius: 8px;
      padding: 16px;
      margin-bottom: 12px;
      border: 1px solid #E5E7EB;
    }

    .variable-item:last-child {
      margin-bottom: 0;
    }

    .variable-header {
      display: flex;
      align-items: center;
      margin-bottom: 12px;
    }

    .variable-color-preview {
      width: 20px;
      height: 20px;
      border-radius: 4px;
      margin-right: 12px;
      border: 1px solid #E5E7EB;
    }

    .variable-name {
      font-weight: 600;
      color: #1F2937;
      font-size: 14px;
    }

    .variable-actions {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .variable-dropdown {
      flex: 1;
      padding: 8px 12px;
      border: 1px solid #E5E7EB;
      border-radius: 6px;
      background: white;
      font-size: 14px;
      color: #374151;
    }

    .variable-dropdown:focus {
      outline: none;
      border-color: #FF6C46;
      box-shadow: 0 0 0 2px rgba(255, 108, 70, 0.1);
    }

  </style>
</head>
<body>
  <div class="container">
    <div class="card">
      <div class="header">
        <div class="logo">
          <svg xmlns="http://www.w3.org/2000/svg" width="116" height="21" viewBox="0 0 116 21" fill="none">
            <path d="M110.163 16.32C108.851 16.32 107.707 16.064 106.731 15.552C105.755 15.024 104.995 14.296 104.451 13.368C103.923 12.424 103.659 11.344 103.659 10.128C103.659 8.88 103.923 7.792 104.451 6.864C104.995 5.936 105.755 5.216 106.731 4.704C107.707 4.176 108.851 3.912 110.163 3.912C111.363 3.912 112.427 4.12 113.355 4.536C114.283 4.952 115.011 5.536 115.539 6.288C116.083 7.024 116.355 7.896 116.355 8.904V9.144H113.787V9C113.787 8.072 113.467 7.384 112.827 6.936C112.187 6.472 111.283 6.24 110.115 6.24C108.771 6.24 107.787 6.568 107.163 7.224C106.539 7.864 106.227 8.832 106.227 10.128C106.227 11.408 106.539 12.376 107.163 13.032C107.787 13.672 108.771 13.992 110.115 13.992C111.283 13.992 112.187 13.768 112.827 13.32C113.467 12.856 113.787 12.16 113.787 11.232V11.064H116.355V11.328C116.355 12.32 116.083 13.192 115.539 13.944C115.011 14.696 114.283 15.28 113.355 15.696C112.427 16.112 111.363 16.32 110.163 16.32Z" fill="#FF7D2C"/>
            <path d="M101.349 16.08H98.7572V9.6C98.7572 8.48 98.4852 7.64 97.9412 7.08C97.4132 6.52 96.5252 6.24 95.2772 6.24C93.9812 6.24 93.0212 6.576 92.3972 7.248C91.7892 7.904 91.4852 8.88 91.4852 10.176L91.0292 10.2L90.9092 7.848H91.4372C91.5652 7.176 91.8212 6.544 92.2052 5.952C92.6052 5.344 93.1492 4.856 93.8372 4.488C94.5412 4.104 95.3972 3.912 96.4052 3.912C97.5092 3.912 98.4292 4.136 99.1652 4.584C99.9012 5.032 100.445 5.632 100.797 6.384C101.165 7.136 101.349 7.976 101.349 8.904V16.08ZM91.4852 16.08H88.8932V4.152H91.2692V7.896L91.4852 8.016V16.08Z" fill="#FF7D2C"/>
            <path d="M76.1535 20.16H74.4495V17.808H76.7775C77.3055 17.808 77.6975 17.72 77.9535 17.544C78.2255 17.384 78.4495 17.104 78.6255 16.704L79.3695 15.096L79.0815 16.416L73.0335 4.152H75.9375L78.9855 10.488L80.1615 13.344H80.3535L81.4815 10.464L84.2895 4.152H87.1455L80.9295 17.376C80.6095 18.08 80.2335 18.632 79.8015 19.032C79.3695 19.448 78.8575 19.736 78.2655 19.896C77.6735 20.072 76.9695 20.16 76.1535 20.16Z" fill="#FF7D2C"/>
            <path d="M66.3154 16.32C64.3954 16.32 62.9074 15.952 61.8514 15.216C60.8114 14.48 60.2914 13.424 60.2914 12.048V11.976H62.8834V12.168C62.8834 12.952 63.1394 13.496 63.6514 13.8C64.1794 14.088 65.0674 14.232 66.3154 14.232C67.4834 14.232 68.2754 14.112 68.6914 13.872C69.1234 13.616 69.3394 13.224 69.3394 12.696C69.3394 12.2 69.1714 11.848 68.8354 11.64C68.5154 11.432 67.9234 11.272 67.0594 11.16L63.7954 10.728C62.6594 10.584 61.7714 10.264 61.1314 9.768C60.4914 9.256 60.1714 8.496 60.1714 7.488C60.1714 6.784 60.3794 6.168 60.7954 5.64C61.2114 5.096 61.8354 4.672 62.6674 4.368C63.4994 4.064 64.5234 3.912 65.7394 3.912C66.9554 3.912 67.9954 4.072 68.8594 4.392C69.7394 4.712 70.4114 5.192 70.8754 5.832C71.3554 6.472 71.5954 7.264 71.5954 8.208V8.28H69.0274V8.136C69.0274 7.672 68.9314 7.28 68.7394 6.96C68.5474 6.64 68.2034 6.4 67.7074 6.24C67.2274 6.064 66.5474 5.976 65.6674 5.976C64.5634 5.976 63.7954 6.104 63.3634 6.36C62.9314 6.616 62.7154 7.024 62.7154 7.584C62.7154 8.048 62.8754 8.384 63.1954 8.592C63.5154 8.8 64.1154 8.968 64.9954 9.096L67.7554 9.48C69.1634 9.656 70.2034 10 70.8754 10.512C71.5474 11.024 71.8834 11.776 71.8834 12.768C71.8834 13.504 71.6514 14.144 71.1874 14.688C70.7234 15.216 70.0754 15.624 69.2434 15.912C68.4114 16.184 67.4354 16.32 66.3154 16.32Z" fill="#FF7D2C"/>
            <path d="M49.6367 16.32C48.4047 16.32 47.3567 16.072 46.4927 15.576C45.6447 15.064 44.9967 14.336 44.5487 13.392C44.1167 12.448 43.9007 11.328 43.9007 10.032C43.9007 8.72 44.1167 7.6 44.5487 6.672C44.9807 5.728 45.6047 5.008 46.4207 4.512C47.2527 4 48.2607 3.744 49.4447 3.744C50.8687 3.744 51.9407 4.056 52.6607 4.68C53.3807 5.288 53.8287 6.096 54.0047 7.104H54.7007V9.888H54.2447C54.2447 9.04 53.9967 8.488 53.5007 8.232C53.0207 7.976 52.2767 7.848 51.2687 7.848C50.5807 7.848 50.0287 7.92 49.6127 8.064C49.1967 8.208 48.9007 8.44 48.7247 8.76C48.5487 9.064 48.4607 9.488 48.4607 10.032C48.4607 10.56 48.5487 10.984 48.7247 11.304C48.9007 11.624 49.1967 11.856 49.6127 12C50.0287 12.128 50.5807 12.192 51.2687 12.192C51.9407 12.192 52.4927 12.136 52.9247 12.024C53.3727 11.912 53.7007 11.704 53.9087 11.4C54.1327 11.08 54.2447 10.632 54.2447 10.056H54.7007L55.0367 12.816H54.2927C54.1007 14.016 53.6287 14.904 52.8767 15.48C52.1407 16.04 51.0607 16.32 49.6367 16.32ZM58.7567 16.08H54.5327V12.672L54.2447 12.36V1.43051e-06H58.7567V16.08Z" fill="#FF7D2C"/>
            <path d="M42.8032 16.08H38.5792V13.392H38.3392V9.096C38.3392 8.488 38.1792 8.104 37.8592 7.944C37.5552 7.768 37.0032 7.68 36.2032 7.68C35.4672 7.68 34.9552 7.768 34.6672 7.944C34.3952 8.12 34.2592 8.464 34.2592 8.976V9.072H29.7472V9.024C29.7472 7.952 30.0272 7.024 30.5872 6.24C31.1472 5.44 31.9392 4.824 32.9632 4.392C33.9872 3.96 35.1792 3.744 36.5392 3.744C37.9472 3.744 39.1152 3.968 40.0432 4.416C40.9712 4.848 41.6592 5.472 42.1072 6.288C42.5712 7.088 42.8032 8.056 42.8032 9.192V16.08ZM33.7792 16.32C32.4192 16.32 31.3632 16.024 30.6112 15.432C29.8752 14.84 29.5072 14.032 29.5072 13.008C29.5072 12.432 29.6432 11.92 29.9152 11.472C30.1872 11.024 30.6112 10.664 31.1872 10.392C31.7632 10.104 32.5072 9.912 33.4192 9.816L38.5792 9.312V11.808L34.6192 12.264C34.4112 12.28 34.2592 12.328 34.1632 12.408C34.0832 12.488 34.0432 12.592 34.0432 12.72C34.0432 12.912 34.1312 13.04 34.3072 13.104C34.4992 13.152 34.7712 13.176 35.1232 13.176C35.9232 13.176 36.5552 13.136 37.0192 13.056C37.4832 12.96 37.8192 12.792 38.0272 12.552C38.2352 12.312 38.3392 11.968 38.3392 11.52L38.6752 11.424V13.536H38.3392C38.1152 14.384 37.6272 15.064 36.8752 15.576C36.1232 16.072 35.0912 16.32 33.7792 16.32Z" fill="#FF7D2C"/>
            <path d="M28.5156 16.08H24.0036V9.984C24.0036 9.136 23.8116 8.56 23.4276 8.256C23.0436 7.936 22.3316 7.776 21.2916 7.776C20.6036 7.776 20.0676 7.84 19.6836 7.968C19.3156 8.096 19.0596 8.312 18.9156 8.616C18.7716 8.904 18.6996 9.312 18.6996 9.84H18.1476V7.656H18.9396C19.0676 6.968 19.3076 6.328 19.6596 5.736C20.0276 5.144 20.5476 4.664 21.2196 4.296C21.8916 3.928 22.7396 3.744 23.7636 3.744C24.8356 3.744 25.7236 3.952 26.4276 4.368C27.1316 4.784 27.6516 5.352 27.9876 6.072C28.3396 6.776 28.5156 7.576 28.5156 8.472V16.08ZM18.6996 16.08H14.1876V1.43051e-06H18.6996V16.08Z" fill="#FF7D2C"/>
            <path d="M6.84 16.32C4.712 16.32 3.088 15.928 1.968 15.144C0.847997 14.36 0.287997 13.272 0.287997 11.88V11.784H4.8V12.024C4.8 12.36 4.936 12.568 5.208 12.648C5.496 12.728 6.048 12.768 6.864 12.768C7.648 12.768 8.144 12.728 8.352 12.648C8.56 12.552 8.664 12.4 8.664 12.192C8.664 12 8.584 11.872 8.424 11.808C8.264 11.728 7.904 11.656 7.344 11.592L3.84 11.208C2.592 11.08 1.64 10.728 0.983997 10.152C0.327997 9.56 -2.68221e-06 8.752 -2.68221e-06 7.728C-2.68221e-06 7.008 0.199997 6.352 0.599997 5.76C1.016 5.152 1.68 4.664 2.592 4.296C3.52 3.928 4.736 3.744 6.24 3.744C7.648 3.744 8.824 3.912 9.768 4.248C10.728 4.584 11.448 5.088 11.928 5.76C12.424 6.416 12.672 7.24 12.672 8.232V8.328H8.16V8.184C8.16 7.976 8.112 7.808 8.016 7.68C7.936 7.536 7.744 7.432 7.44 7.368C7.152 7.304 6.704 7.272 6.096 7.272C5.36 7.272 4.896 7.328 4.704 7.44C4.528 7.536 4.44 7.696 4.44 7.92C4.44 8.08 4.528 8.208 4.704 8.304C4.896 8.4 5.344 8.488 6.048 8.568L8.448 8.832C10.208 9.024 11.424 9.416 12.096 10.008C12.768 10.6 13.104 11.408 13.104 12.432C13.104 13.184 12.856 13.856 12.36 14.448C11.88 15.024 11.176 15.48 10.248 15.816C9.32 16.152 8.184 16.32 6.84 16.32Z" fill="#FF7D2C"/>
          </svg>
        </div>
        <div class="tabs">
          <button class="tab active" data-tab="update">Update Theme</button>
          <button class="tab" data-tab="detect">Detect</button>
        </div>
      </div>

  <!-- Update Theme Tab -->
  <div id="update-tab" class="tab-content">
    <div class="section">
      <label for="css-input">Paste CSS</label>
      <textarea 
        id="css-input" 
        placeholder=":root {
  --background: #f9f9fa;
  --foreground: #333333;
  --card: #ffffff;
  --card-foreground: #333333;
  --popover: #ffffff;
  --primary: 220 80% 60%;
  --primary-foreground: #ffffff;
}"
      ></textarea>
    </div>

    <div class="input-group">
      <label>Collection</label>
      <div style="padding: 8px 12px; background: #f5f5f5; border-radius: 6px; color: #666; font-size: 14px;">
        shadsync theme
      </div>
    </div>

    <div class="status" id="status"></div>

    <button class="button button-primary" id="update-variables">
      Update Variables
    </button>
  </div>

  <!-- Detect Tab -->
  <div id="detect-tab" class="tab-content hidden">
    <div class="scan-section">
      <div class="scan-title">Detect</div>
      <div class="scan-actions">
        <button class="scan-btn" id="check-variables">Scan</button>
        <button class="replace-all-btn" id="replace-all-btn" disabled>Replace All</button>
      </div>
    </div>
    
    <div id="variables-result" class="hidden">
      <!-- Non-ShadSync Variables Section -->
      <div id="non-shadsync-section" class="hidden">
        <div id="non-shadsync-list"></div>
      </div>
      
      <!-- All Variable-Assigned Objects Section -->
      <div id="all-variables-section" class="hidden">
        <div id="all-variables-list"></div>
      </div>
      
      <!-- Unassigned Objects Section -->
      <div id="unassigned-section" class="hidden">
        <div id="unassigned-list"></div>
      </div>
      
      <!-- Usage Summary Section -->
      <div id="usage-summary" class="hidden"></div>
      
      <!-- All Clear Message -->
      <div id="all-clear-message" class="hidden">
        <div style="text-align: center; padding: 40px; color: #6B7280;">
          No variables found from other collections. All good! ‚úÖ
        </div>
      </div>
    </div>
        
        <!-- Non-ShadSync Variables Section -->
        <div id="non-shadsync-section" class="hidden">
          <div class="section-title" style="color: #ff6b35;">‚ö†Ô∏è Variables from Other Collections</div>
          <p style="font-size: 11px; color: #666; margin-bottom: 12px;">
            These variables from other collections are being used. Replace them with shadsync theme variables:
          </p>
          
          <div class="suggestion-list" id="non-shadsync-list"></div>
        </div>
        
        <!-- All Variable-Assigned Objects Section -->
        <div id="all-variables-section" class="hidden">
          <div class="section-title" style="color: #2196f3;">üîÑ All Variable-Assigned Objects</div>
          <p style="font-size: 11px; color: #666; margin-bottom: 12px;">
            All objects using variables (from any collection). Review and replace with better shadsync theme options:
          </p>
          <div class="suggestion-list" id="all-variables-list"></div>
        </div>
        
        <!-- Unassigned Objects Section -->
        <div id="unassigned-section" class="hidden">
          <div class="section-title" style="color: #999;">Objects Without Variables</div>
          <p style="font-size: 11px; color: #666; margin-bottom: 12px;">
            These objects have colors but no variables assigned:
          </p>
          <div class="suggestion-list" id="unassigned-list"></div>
        </div>
        
        <!-- Current Usage Summary -->
        <div id="usage-summary" class="hidden">
          <div class="section-title" style="color: #4caf50;">‚úÖ Current ShadSync Usage</div>
          <div id="variables-list"></div>
        </div>
        
        <!-- All Clear Message -->
        <div id="all-clear-message" class="hidden">
          <div style="text-align: center; padding: 24px; color: #4caf50;">
            <div style="font-size: 18px; margin-bottom: 8px;">üéâ</div>
            <div style="font-weight: 600; margin-bottom: 4px;">All Good!</div>
            <div style="font-size: 12px; color: #666;">All objects are using shadsync theme variables or have no variables assigned.</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // Tab switching
    document.querySelectorAll('.tab').forEach(tab => {
      tab.addEventListener('click', () => {
        const tabName = tab.dataset.tab;
        
        // Update active tab
        document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
        tab.classList.add('active');
        
        // Hide all tab content
        document.querySelectorAll('.tab-content').forEach(content => {
          content.classList.add('hidden');
        });
        
        // Show selected tab content
        const targetTab = document.getElementById(`${tabName}-tab`);
        if (targetTab) {
          targetTab.classList.remove('hidden');
        }
        
        // Clear status when switching tabs
        hideStatus();
      });
    });

    // Status message functions
    function showStatus(message, type = 'info') {
      const status = document.getElementById('status');
      status.textContent = message;
      status.className = `status ${type}`;
      status.style.display = 'block';
      
      if (type === 'success') {
        setTimeout(() => {
          status.style.display = 'none';
        }, 5000);
      }
    }

    function hideStatus() {
      document.getElementById('status').style.display = 'none';
    }

    // Update Variables
    document.getElementById('update-variables').addEventListener('click', () => {
      const css = document.getElementById('css-input').value.trim();
      
      if (!css) {
        showStatus('Please paste CSS variables first', 'error');
        return;
      }
      
      showStatus('Processing variables...', 'info');
      document.body.classList.add('loading');
      
      parent.postMessage({
        pluginMessage: {
          type: 'convert-css',
          css: css,
          collectionName: 'shadsync theme'
        }
      }, '*');
    });

    // Check Variables
    document.getElementById('check-variables').addEventListener('click', () => {
      showStatus('Scanning document for variables...', 'info');
      document.body.classList.add('loading');
      
      parent.postMessage({
        pluginMessage: {
          type: 'check-variables'
        }
      }, '*');
    });

    // Handle messages from plugin
    window.onmessage = (event) => {
      const msg = event.data.pluginMessage;
      if (!msg) return;
      
      document.body.classList.remove('loading');
      
      switch (msg.type) {
        case 'success':
          showStatus(msg.message, 'success');
          break;
          
        case 'error':
          showStatus(msg.message, 'error');
          break;
          
        case 'status':
          showStatus(msg.message, 'info');
          break;
          
        case 'variables-check-result':
          displayVariablesResult(msg.data);
          // Show scan summary
          const summary = msg.data.scanSummary;
          if (summary.nonShadSyncCount > 0) {
            showStatus(`Found ${summary.nonShadSyncCount} non-shadsync variable${summary.nonShadSyncCount !== 1 ? 's' : ''} in use`, 'error');
          } else if (summary.allVariableCount > 0) {
            showStatus(`Found ${summary.allVariableCount} variable${summary.allVariableCount !== 1 ? 's' : ''} in use (review for optimization)`, 'info');
          } else if (summary.unassignedCount > 0) {
            showStatus(`Found ${summary.unassignedCount} objects without variables assigned`, 'info');
          } else {
            showStatus('All objects are using shadsync theme variables! üéâ', 'success');
          }
          break;
      }
    };

    // Display variables check result
    function displayVariablesResult(data) {
      const resultDiv = document.getElementById('variables-result');
      
      // Show/hide sections based on data
      const nonShadSyncSection = document.getElementById('non-shadsync-section');
      const allVariablesSection = document.getElementById('all-variables-section');
      const unassignedSection = document.getElementById('unassigned-section');
      const usageSummarySection = document.getElementById('usage-summary');
      const allClearMessage = document.getElementById('all-clear-message');
      
      // Handle Replace All button state - enable if any variables can be replaced
      const replaceAllBtn = document.getElementById('replace-all-btn');
      const hasNonShadSync = data.nonShadSyncVariables && data.nonShadSyncVariables.length > 0;
      const hasAllVariablesWithSuggestions = data.allVariableAssigned && 
        data.allVariableAssigned.some(group => group.suggestion && group.suggestion.id);
      
      if (hasNonShadSync || hasAllVariablesWithSuggestions) {
        if (replaceAllBtn) {
          replaceAllBtn.disabled = false;
          replaceAllBtn.style.opacity = '1';
        }
      } else {
        if (replaceAllBtn) {
          replaceAllBtn.disabled = true;
          replaceAllBtn.style.opacity = '0.5';
        }
      }
      
      // Priority 1: Non-ShadSync Variables (most important)
      if (data.nonShadSyncVariables && data.nonShadSyncVariables.length > 0) {
        displayNonShadSyncVariables(data.nonShadSyncVariables);
        nonShadSyncSection.classList.remove('hidden');
      } else {
        nonShadSyncSection.classList.add('hidden');
      }
      
      // Priority 2: All Variable-Assigned Objects (for review and optimization)
      if (data.allVariableAssigned && data.allVariableAssigned.length > 0) {
        displayAllVariableAssigned(data.allVariableAssigned);
        allVariablesSection.classList.remove('hidden');
      } else {
        allVariablesSection.classList.add('hidden');
      }
      
      // Priority 3: Unassigned Objects (secondary)
      if (data.unassignedObjects && data.unassignedObjects.length > 0) {
        displayUnassignedObjects(data.unassignedObjects);
        unassignedSection.classList.remove('hidden');
      } else {
        unassignedSection.classList.add('hidden');
      }
      
      // Usage Summary (always show if we have shadsync variables being used)
      if (data.variablesByCollection && data.variablesByCollection['shadsync theme']) {
        displayUsageSummary(data.variablesByCollection, data.mainCollectionName);
        usageSummarySection.classList.remove('hidden');
      } else {
        usageSummarySection.classList.add('hidden');
      }
      
      // Show "All Clear" message if no issues found
      if ((!data.nonShadSyncVariables || data.nonShadSyncVariables.length === 0) && 
          (!data.unassignedObjects || data.unassignedObjects.length === 0)) {
        allClearMessage.classList.remove('hidden');
      } else {
        allClearMessage.classList.add('hidden');
      }
      
      resultDiv.classList.remove('hidden');
      
      // Set up Replace All button event listener
      setTimeout(() => {
        const replaceAllBtn = document.getElementById('replace-all-btn');
        if (replaceAllBtn) {
          replaceAllBtn.removeEventListener('click', window.replaceAllVariables);
          replaceAllBtn.addEventListener('click', window.replaceAllVariables);
        }
      }, 100);
      
      hideStatus();
    }
    
    // Display variables from non-shadsync collections (grouped by variable)
    function displayNonShadSyncVariables(nonShadSyncVariables) {
      const listDiv = document.getElementById('non-shadsync-list');
      let html = '';
      
      if (nonShadSyncVariables.length > 0) {
        html += `
          <div class="variable-section">
            <div class="variable-section-header">
              <div class="variable-section-title">Base</div>
              <div class="variable-count">${nonShadSyncVariables.length} variable${nonShadSyncVariables.length !== 1 ? 's' : ''}</div>
            </div>
        `;
        
        nonShadSyncVariables.forEach((variableGroup, groupIndex) => {
          const hasColor = variableGroup.objects && variableGroup.objects[0] && variableGroup.objects[0].color;
          const colorStyle = hasColor ? 
            `background: rgb(${Math.round((variableGroup.objects[0].color.r || 0) * 255)}, ${Math.round((variableGroup.objects[0].color.g || 0) * 255)}, ${Math.round((variableGroup.objects[0].color.b || 0) * 255)})` : 
            'background: #E5E7EB';
          
          html += `
            <div class="variable-item">
              <div class="variable-header">
                <div class="variable-color-preview" style="${colorStyle}"></div>
                <div class="variable-name">${variableGroup.currentVariable.name}</div>
              </div>
              <div class="variable-actions">
                <select class="variable-dropdown" id="select-group-${groupIndex}">
          `;
          
          // Add dropdown options
          if (variableGroup.allSuggestions && variableGroup.allSuggestions.length > 0) {
            variableGroup.allSuggestions.forEach(suggestion => {
              const selected = variableGroup.suggestion && suggestion.id === variableGroup.suggestion.id ? 'selected' : '';
              html += `<option value="${suggestion.id}" ${selected}>${suggestion.name} (${suggestion.score}% match)</option>`;
            });
          } else {
            html += '<option value="">No suggestions available</option>';
          }
          
          html += `
                </select>
                <button class="replace-btn" id="replace-btn-${groupIndex}" data-group-index="${groupIndex}" data-select-id="select-group-${groupIndex}">
                  Replace
                </button>
              </div>
            </div>
          `;
        });
        
        html += `</div>`;
      }
      
      listDiv.innerHTML = html;
      
      // Store the grouped data for replacement functionality
      window.nonShadSyncGroups = nonShadSyncVariables;
      
      // Show/hide the Replace All button
      const replaceAllBtn = document.getElementById('replace-all-btn');
      if (nonShadSyncVariables.length > 0) {
        replaceAllBtn.style.display = 'block';
      } else {
        replaceAllBtn.style.display = 'none';
      }
      
      // Add event listeners to replace buttons
      setTimeout(() => {
        nonShadSyncVariables.forEach((variableGroup, index) => {
          const button = document.getElementById(`replace-btn-${index}`);
          if (button) {
            button.addEventListener('click', function() {
              const buttonGroupIndex = parseInt(this.getAttribute('data-group-index'));
              const selectId = this.getAttribute('data-select-id');
              window.applyGroupReplacement(buttonGroupIndex, selectId);
            });
          }
        });
      }, 100);
    }
    
    // Display all variable-assigned objects for review and replacement
    function displayAllVariableAssigned(allVariableAssigned) {
      const listDiv = document.getElementById('all-variables-list');
      let html = '';
      
      allVariableAssigned.forEach((variableGroup, groupIndex) => {
        const isShadsyncVariable = variableGroup.currentVariable.collection === 'shadsync theme';
        const isReplaced = variableGroup.replaced === true;
        const borderColor = isReplaced ? '#41D7AF' : (isShadsyncVariable ? '#41D7AF' : '#ff6b35');
        const backgroundColor = isReplaced ? '#f0fffe' : '#f8f9fa';
        const badgeColor = isReplaced ? '#41D7AF' : (isShadsyncVariable ? '#41D7AF' : '#ff6b35');
        const textColor = isReplaced ? '#065f46' : '#333';
        
        // Use the cleaner suggestion-item layout
        html += `
          <div class="suggestion-item" style="border-left: 4px solid ${borderColor}; background: ${backgroundColor};">
            <div class="suggestion-header">
              <div class="object-info" style="color: ${textColor}; display: flex; justify-content: space-between; align-items: center; width: 100%;">
                <strong>${variableGroup.currentVariable.name}</strong>
                <div style="display: flex; align-items: center; gap: 8px; margin-left: auto;">
                  <span style="background: ${badgeColor}; color: white; padding: 2px 6px; border-radius: 12px; font-size: 10px;">
                    ${variableGroup.objects.length} object${variableGroup.objects.length !== 1 ? 's' : ''}
                  </span>
                  ${isReplaced ? '<span style="color: #41D7AF; font-size: 12px;">‚úÖ Replaced</span>' : ''}
                  ${isShadsyncVariable && !isReplaced ? '<span style="color: #41D7AF; font-size: 12px;">‚úÖ Already ShadSync</span>' : ''}
                </div>
              </div>
            </div>
            
            <div class="suggestion-row">
              <select class="select-dropdown" id="select-all-group-${groupIndex}" onchange="updateAllVariableSelectedVariable('${variableGroup.currentVariable.name}', this.value, ${groupIndex})" ${isReplaced ? 'disabled' : ''}>
                <option value="">${isShadsyncVariable ? 'Switch to different shadsync variable...' : 'Choose shadsync replacement...'}</option>
        `;
        
        // Add all shadsync variables to dropdown
        if (variableGroup.allShadSyncVariables && variableGroup.allShadSyncVariables.length > 0) {
          // First show smart suggestions if any
          if (variableGroup.allSuggestions && variableGroup.allSuggestions.length > 0) {
            html += '<optgroup label="‚≠ê Smart Suggestions">';
            variableGroup.allSuggestions.forEach(suggestion => {
              const selected = variableGroup.suggestion && suggestion.id === variableGroup.suggestion.id ? 'selected' : '';
              const emoji = suggestion.score >= 80 ? '‚≠ê' : suggestion.score >= 60 ? '‚úÖ' : 'üîß';
              html += `<option value="${suggestion.id}" ${selected}>${emoji} ${suggestion.name} (${suggestion.score}% match)</option>`;
            });
            html += '</optgroup>';
          }
          
          // Then show all available variables
          html += '<optgroup label="üé® All ShadSync Variables">';
          variableGroup.allShadSyncVariables.forEach(variable => {
            const isCurrentVariable = variable.id === variableGroup.currentVariable.id;
            const isInSuggestions = variableGroup.allSuggestions && 
              variableGroup.allSuggestions.some(s => s.id === variable.id);
            if (!isInSuggestions && !isCurrentVariable) {
              html += `<option value="${variable.id}">${variable.name}</option>`;
            } else if (isCurrentVariable) {
              html += `<option value="${variable.id}" style="color: #666; font-style: italic;">${variable.name} (current)</option>`;
            }
          });
          html += '</optgroup>';
        }
        
        html += `
              </select>
              <button class="replace-btn" id="replace-all-btn-${groupIndex}" data-group-index="${groupIndex}" data-select-id="select-all-group-${groupIndex}"
                      style="background: ${borderColor};" ${isReplaced ? 'disabled' : ''}>
                ${isReplaced ? '‚úÖ Replaced' : 'Replace'}
              </button>
            </div>
          </div>
        `;
      });
      
      listDiv.innerHTML = html;
      
      // Store the grouped data for replacement functionality
      window.allVariableGroups = allVariableAssigned;
      
      // Add event listeners to replace buttons
      setTimeout(() => {
        allVariableAssigned.forEach((variableGroup, index) => {
          const button = document.getElementById(`replace-all-btn-${index}`);
          if (button) {
            console.log(`Adding event listener to all-variables button ${index}`);
            button.addEventListener('click', function() {
              console.log(`All-variables button ${index} clicked`);
              const buttonGroupIndex = parseInt(this.getAttribute('data-group-index'));
              const selectId = this.getAttribute('data-select-id');
              window.applyAllVariableGroupReplacement(buttonGroupIndex, selectId);
            });
          } else {
            console.error(`All-variables button not found: replace-all-btn-${index}`);
          }
        });
      }, 100);
    }

    // Display objects without variables
    function displayUnassignedObjects(unassignedObjects) {
      const listDiv = document.getElementById('unassigned-list');
      let html = '';
      
      unassignedObjects.forEach((item, index) => {
        const hasColor = item.color && (item.color.r !== undefined || item.color.g !== undefined || item.color.b !== undefined);
        const colorStyle = hasColor ? 
          `background: rgb(${Math.round((item.color.r || 0) * 255)}, ${Math.round((item.color.g || 0) * 255)}, ${Math.round((item.color.b || 0) * 255)})` : 
          'background: #ccc';
        
        html += `
          <div class="suggestion-item">
            <div class="suggestion-header">
              <div class="object-info">${item.node.name} (${item.node.type})</div>
            </div>
            <div class="current-variable">No variable assigned</div>
        `;
        
        if (item.allSuggestions && item.allSuggestions.length > 0) {
          html += `
            <div class="suggestion-row">
              <div class="color-preview" style="${colorStyle}"></div>
              <select class="select-dropdown" id="select-${index}-unassigned" onchange="updateSelectedVariable('${item.node.id}', '${item.property}', this.value, ${item.fillIndex || 0}, ${item.strokeIndex || 0})">
                <option value="">Choose shadsync variable...</option>
          `;
          
          item.allSuggestions.forEach(suggestion => {
            const selected = item.suggestion && suggestion.id === item.suggestion.id ? 'selected' : '';
            html += `<option value="${suggestion.id}" ${selected}>${suggestion.name} (${suggestion.score}% match)</option>`;
          });
          
          html += `
              </select>
              <button class="replace-btn" onclick="applySelectedVariable('${item.node.id}', '${item.property}', 'select-${index}-unassigned', ${item.fillIndex || 0}, ${item.strokeIndex || 0})">
                Apply
              </button>
            </div>
          `;
        } else {
          html += `
            <div class="no-suggestion">No matching shadsync variable found</div>
          `;
        }
        
        html += '</div>';
      });
      
      listDiv.innerHTML = html;
    }
    
    // Display usage summary
    function displayUsageSummary(variablesByCollection, mainCollectionName) {
      const listDiv = document.getElementById('variables-list');
      let html = '';
      
      Object.entries(variablesByCollection).forEach(([collectionName, variables]) => {
        const isMainCollection = collectionName === mainCollectionName;
        html += `
          <div class="collection-group">
            <div class="collection-title">
              ${collectionName} ${isMainCollection ? '(Main)' : ''}
              <span style="color: #666; font-weight: normal;">(${variables.length} variables)</span>
            </div>
            <div class="variables-list">
        `;
        
        variables.forEach(variable => {
          html += `
            <div class="variable-item">
              ${variable.name} <span style="color: #666;">(${variable.type})</span>
            </div>
          `;
        });
        
        html += '</div></div>';
      });
      
      listDiv.innerHTML = html;
    }
    
    // Replace variable function
    function replaceVariable(nodeId, property, newVariableId) {
      parent.postMessage({
        pluginMessage: {
          type: 'replace-variable',
          nodeId: nodeId,
          property: property,
          newVariableId: newVariableId
        }
      }, '*');
    }
    
    // Update selected variable in dropdown
    function updateSelectedVariable(nodeId, property, newVariableId, fillIndex, strokeIndex) {
      // This function can be used to provide immediate feedback
      console.log('Variable selected:', newVariableId);
    }
    
    // Update selected variable for all-variable groups (called by dropdown onchange)
    function updateAllVariableSelectedVariable(originalVariableName, newVariableId, groupIndex) {
      console.log('updateAllVariableSelectedVariable called:', originalVariableName, newVariableId, groupIndex);
      
      // Store the selection for when Apply is clicked
      if (window.allVariableGroups && window.allVariableGroups[groupIndex]) {
        window.allVariableGroups[groupIndex].selectedVariableId = newVariableId;
      }
      
      // Visual feedback: enable/disable Apply button based on selection
      const button = document.getElementById(`replace-all-btn-${groupIndex}`);
      if (button && !button.disabled) {
        if (newVariableId) {
          button.style.opacity = '1';
          button.style.cursor = 'pointer';
        } else {
          button.style.opacity = '0.6';
          button.style.cursor = 'not-allowed';
        }
      }
    }
    
    // Apply selected variable from dropdown
    function applySelectedVariable(nodeId, property, selectId, fillIndex, strokeIndex) {
      const selectElement = document.getElementById(selectId);
      const newVariableId = selectElement.value;
      
      if (!newVariableId) {
        showStatus('Please select a variable first', 'error');
        return;
      }
      
      // Find the button that was clicked (should be near the select)
      const container = selectElement.closest('.suggestion-item');
      const button = container ? container.querySelector('.replace-btn') : null;
      
      // Visual feedback: mark as applied
      if (button) {
        button.style.background = '#41D7AF';
        button.textContent = '‚úÖ Applied';
        button.disabled = true;
      }
      
      // Update the card visual appearance
      if (container) {
        container.style.borderLeftColor = '#41D7AF';
        container.style.background = '#f0fffe';
        
        // Update text colors
        const objectInfo = container.querySelector('.object-info');
        const currentVariable = container.querySelector('.current-variable');
        if (objectInfo) objectInfo.style.color = '#2e7d32';
        if (currentVariable) currentVariable.style.color = '#2e7d32';
        
        // Add success checkmark to header
        if (objectInfo && !objectInfo.querySelector('.success-indicator')) {
          const successSpan = document.createElement('span');
          successSpan.className = 'success-indicator';
          successSpan.style.cssText = 'color: #41D7AF; font-size: 12px; margin-left: 8px;';
          successSpan.textContent = '‚úÖ Applied';
          objectInfo.appendChild(successSpan);
        }
      }
      
      // Disable the dropdown
      selectElement.disabled = true;
      
      parent.postMessage({
        pluginMessage: {
          type: 'replace-variable',
          nodeId: nodeId,
          property: property,
          newVariableId: newVariableId,
          fillIndex: fillIndex,
          strokeIndex: strokeIndex
        }
      }, '*');
      
      showStatus('‚úÖ Variable replacement applied successfully!', 'success');
    }

    // Make sure the function is available globally
    window.applyGroupReplacement = function(groupIndex, selectId) {
      console.log('applyGroupReplacement called:', groupIndex, selectId);
      console.log('Available functions:', typeof updateSelectedVariable, typeof applySelectedVariable);
      console.log('Window object keys:', Object.keys(window));
      
      const selectElement = document.getElementById(selectId);
      if (!selectElement) {
        console.error('Select element not found:', selectId);
        console.log('Available elements with select-group prefix:', document.querySelectorAll('[id^="select-group"]'));
        showStatus('Dropdown not found', 'error');
        return;
      }
      
      const newVariableId = selectElement.value;
      console.log('Selected variable ID:', newVariableId);
      
      if (!newVariableId) {
        showStatus('Please select a variable first', 'error');
        return;
      }
      
      if (!window.nonShadSyncGroups || !window.nonShadSyncGroups[groupIndex]) {
        console.error('Group data not found:', window.nonShadSyncGroups, groupIndex);
        showStatus('Group data not found', 'error');
        return;
      }
      
      const group = window.nonShadSyncGroups[groupIndex];
      console.log('Processing group:', group);
      let replacementCount = 0;
      
      // Replace variable for each object in the group
      group.objects.forEach((obj, index) => {
        console.log(`Replacing object ${index + 1}:`, obj.node.id, obj.property, newVariableId);
        
        parent.postMessage({
          pluginMessage: {
            type: 'replace-variable',
            nodeId: obj.node.id,
            property: obj.property,
            newVariableId: newVariableId,
            fillIndex: obj.fillIndex || 0,
            strokeIndex: obj.strokeIndex || 0
          }
        }, '*');
        replacementCount++;
      });
      
      showStatus(`Replacing variable for ${replacementCount} objects...`, 'info');
      
      // Re-run detection after a short delay to update the UI
      setTimeout(() => {
        console.log('Re-running variable check...');
        parent.postMessage({
          pluginMessage: { type: 'check-variables' }
        }, '*');
      }, 1000);
    };

    // Replace all non-shadsync variables with their best suggestions
    window.replaceAllNonShadSync = function() {
      console.log('replaceAllNonShadSync called');
      
      if (!window.nonShadSyncGroups || window.nonShadSyncGroups.length === 0) {
        showStatus('No non-shadsync variables found', 'error');
        return;
      }
      
      let totalReplacements = 0;
      let groupsWithSuggestions = 0;
      
      // Process each group
      window.nonShadSyncGroups.forEach((group, groupIndex) => {
        if (group.suggestion && group.suggestion.id) {
          groupsWithSuggestions++;
          
          // Replace variable for each object in the group
          group.objects.forEach((obj, objIndex) => {
            console.log(`Replacing object ${objIndex + 1} in group ${groupIndex}:`, obj.node.id, obj.property, group.suggestion.id);
            
            parent.postMessage({
              pluginMessage: {
                type: 'replace-variable',
                nodeId: obj.node.id,
                property: obj.property,
                newVariableId: group.suggestion.id,
                fillIndex: obj.fillIndex || 0,
                strokeIndex: obj.strokeIndex || 0
              }
            }, '*');
            totalReplacements++;
          });
        } else {
          console.warn(`Group ${groupIndex} has no suggestion:`, group);
        }
      });
      
      if (totalReplacements > 0) {
        showStatus(`Replacing ${totalReplacements} objects across ${groupsWithSuggestions} variable groups...`, 'info');
        
        // Re-run detection after a delay to update the UI
        setTimeout(() => {
          console.log('Re-running variable check after bulk replacement...');
          parent.postMessage({
            pluginMessage: { type: 'check-variables' }
          }, '*');
        }, 1500); // Slightly longer delay for bulk operation
      } else {
        showStatus('No suitable suggestions found for bulk replacement', 'warning');
      }
    };

    // Replace all variables (both non-shadsync and all-variables with suggestions)
    window.replaceAllVariables = function() {
      console.log('replaceAllVariables called');
      
      let totalReplacements = 0;
      let groupsWithSuggestions = 0;
      
      // Process non-shadsync variables
      if (window.nonShadSyncGroups && window.nonShadSyncGroups.length > 0) {
        window.nonShadSyncGroups.forEach((group, groupIndex) => {
          if (group.suggestion && group.suggestion.id) {
            groupsWithSuggestions++;
            
            // Replace variable for each object in the group
            group.objects.forEach((obj, objIndex) => {
              console.log(`Replacing non-shadsync object ${objIndex + 1} in group ${groupIndex}:`, obj.node.id, obj.property, group.suggestion.id);
              
              parent.postMessage({
                pluginMessage: {
                  type: 'replace-variable',
                  nodeId: obj.node.id,
                  property: obj.property,
                  newVariableId: group.suggestion.id,
                  fillIndex: obj.fillIndex || 0,
                  strokeIndex: obj.strokeIndex || 0
                }
              }, '*');
              totalReplacements++;
            });
          }
        });
      }
      
      // Process all-variable-assigned objects
      if (window.allVariableGroups && window.allVariableGroups.length > 0) {
        window.allVariableGroups.forEach((group, groupIndex) => {
          if (group.suggestion && group.suggestion.id) {
            groupsWithSuggestions++;
            
            // Replace variable for each object in the group
            group.objects.forEach((obj, objIndex) => {
              console.log(`Replacing all-variable object ${objIndex + 1} in group ${groupIndex}:`, obj.node.id, obj.property, group.suggestion.id);
              
              parent.postMessage({
                pluginMessage: {
                  type: 'replace-variable',
                  nodeId: obj.node.id,
                  property: obj.property,
                  newVariableId: group.suggestion.id,
                  fillIndex: obj.fillIndex || 0,
                  strokeIndex: obj.strokeIndex || 0
                }
              }, '*');
              totalReplacements++;
            });
          }
        });
      }
      
      if (totalReplacements > 0) {
        showStatus(`Replacing ${totalReplacements} objects across ${groupsWithSuggestions} variable groups...`, 'info');
        
        // Re-run detection after a delay to update the UI
        setTimeout(() => {
          console.log('Re-running variable check after bulk replacement...');
          parent.postMessage({
            pluginMessage: { type: 'check-variables' }
          }, '*');
        }, 1500); // Slightly longer delay for bulk operation
      } else {
        showStatus('No suitable suggestions found for bulk replacement', 'warning');
      }
    };

    // Apply group replacement for all variable-assigned objects
    window.applyAllVariableGroupReplacement = function(groupIndex, selectId) {
      console.log('applyAllVariableGroupReplacement called:', groupIndex, selectId);
      
      const selectElement = document.getElementById(selectId);
      if (!selectElement) {
        console.error('Select element not found:', selectId);
        showStatus('Dropdown not found', 'error');
        return;
      }
      
      const newVariableId = selectElement.value;
      console.log('Selected variable ID:', newVariableId);
      
      if (!newVariableId) {
        showStatus('Please select a variable first', 'error');
        return;
      }
      
      if (!window.allVariableGroups || !window.allVariableGroups[groupIndex]) {
        console.error('All-variable group data not found:', window.allVariableGroups, groupIndex);
        showStatus('Group data not found', 'error');
        return;
      }
      
      const group = window.allVariableGroups[groupIndex];
      console.log('Processing all-variable group:', group);
      let replacementCount = 0;
      
      // Visual feedback: mark as applying
      const button = document.getElementById(`replace-all-btn-${groupIndex}`);
      if (button) {
        button.style.background = '#41D7AF';
        button.textContent = '‚úÖ Replaced';
        button.disabled = true;
      }
      
      // Mark the group as replaced
      if (window.allVariableGroups[groupIndex]) {
        window.allVariableGroups[groupIndex].replaced = true;
      }
      
      // Update the card visual appearance
      const card = button.closest('.suggestion-item');
      if (card) {
        card.style.borderLeftColor = '#41D7AF';
        card.style.background = '#f0fffe';
        
        // Update text colors
        const objectInfo = card.querySelector('.object-info');
        const currentVariable = card.querySelector('.current-variable');
        if (objectInfo) objectInfo.style.color = '#065f46';
        if (currentVariable) currentVariable.style.color = '#065f46';
        
        // Add success checkmark to header
        if (objectInfo && !objectInfo.querySelector('.success-indicator')) {
          const successSpan = document.createElement('span');
          successSpan.className = 'success-indicator';
          successSpan.style.cssText = 'color: #41D7AF; font-size: 12px; margin-left: 8px;';
          successSpan.textContent = '‚úÖ Replaced';
          objectInfo.appendChild(successSpan);
        }
      }
      
      // Disable the dropdown
      selectElement.disabled = true;
      
      // Replace variable for each object in the group
      group.objects.forEach((obj, index) => {
        console.log(`Replacing all-variable object ${index + 1}:`, obj.node.id, obj.property, newVariableId);
        
        parent.postMessage({
          pluginMessage: {
            type: 'replace-variable',
            nodeId: obj.node.id,
            property: obj.property,
            newVariableId: newVariableId,
            fillIndex: obj.fillIndex || 0,
            strokeIndex: obj.strokeIndex || 0
          }
        }, '*');
        replacementCount++;
      });
      
      showStatus(`‚úÖ Successfully replaced variable for ${replacementCount} objects!`, 'success');
      
      // Re-run detection after a short delay to update the UI
      setTimeout(() => {
        console.log('Re-running variable check after all-variable replacement...');
        parent.postMessage({
          pluginMessage: { type: 'check-variables' }
        }, '*');
      }, 1000);
    };

    // Apply group replacement for all variable-assigned objects
    function applyAllVariableGroupReplacement(groupIndex, selectId) {
      return window.applyAllVariableGroupReplacement(groupIndex, selectId);
    }

    // Apply group replacement - replace variable for all objects in a group
    function applyGroupReplacement(groupIndex, selectId) {
      return window.applyGroupReplacement(groupIndex, selectId);
    }

    // Initialize when page loads
    window.addEventListener('load', function() {
      console.log('Page loaded. Available functions:');
      console.log('- applyGroupReplacement:', typeof applyGroupReplacement);
      console.log('- applySelectedVariable:', typeof applySelectedVariable);
      console.log('- updateSelectedVariable:', typeof updateSelectedVariable);
    });
  </script>
    </div>
  </div>
</body>
</html>
